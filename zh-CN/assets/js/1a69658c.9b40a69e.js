"use strict";(self.webpackChunkselectdb_portal=self.webpackChunkselectdb_portal||[]).push([[91088],{3905:(e,n,r)=>{r.d(n,{Zo:()=>p,kt:()=>b});var t=r(67294);function o(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function s(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function a(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?s(Object(r),!0).forEach((function(n){o(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function l(e,n){if(null==e)return{};var r,t,o=function(e,n){if(null==e)return{};var r,t,o={},s=Object.keys(e);for(t=0;t<s.length;t++)r=s[t],n.indexOf(r)>=0||(o[r]=e[r]);return o}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)r=s[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var i=t.createContext({}),c=function(e){var n=t.useContext(i),r=n;return e&&(r="function"==typeof e?e(n):a(a({},n),e)),r},p=function(e){var n=c(e.components);return t.createElement(i.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var r=e.components,o=e.mdxType,s=e.originalType,i=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=c(r),b=o,d=m["".concat(i,".").concat(b)]||m[b]||u[b]||s;return r?t.createElement(d,a(a({ref:n},p),{},{components:r})):t.createElement(d,a({ref:n},p))}));function b(e,n){var r=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var s=r.length,a=new Array(s);a[0]=m;var l={};for(var i in n)hasOwnProperty.call(n,i)&&(l[i]=n[i]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var c=2;c<s;c++)a[c]=r[c];return t.createElement.apply(null,a)}return t.createElement.apply(null,r)}m.displayName="MDXCreateElement"},9354:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var t=r(87462),o=(r(67294),r(3905));const s={title:"OUTFILE",language:"zh-CN"},a=void 0,l={unversionedId:"sql-reference/sql-statements/Data-Manipulation/OUTFILE",id:"version-1.0/sql-reference/sql-statements/Data-Manipulation/OUTFILE",title:"OUTFILE",description:"\x3c!--",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-1.0/sql-reference/sql-statements/Data-Manipulation/OUTFILE.md",sourceDirName:"sql-reference/sql-statements/Data-Manipulation",slug:"/sql-reference/sql-statements/Data-Manipulation/OUTFILE",permalink:"/zh-CN/docs/1.0/sql-reference/sql-statements/Data-Manipulation/OUTFILE",draft:!1,tags:[],version:"1.0",frontMatter:{title:"OUTFILE",language:"zh-CN"},sidebar:"docs",previous:{title:"MULTI LOAD",permalink:"/zh-CN/docs/1.0/sql-reference/sql-statements/Data-Manipulation/MULTI-LOAD"},next:{title:"PAUSE ROUTINE LOAD",permalink:"/zh-CN/docs/1.0/sql-reference/sql-statements/Data-Manipulation/PAUSE-ROUTINE-LOAD"}},i={},c=[{value:"description",id:"description",level:2},{value:"example",id:"example",level:2},{value:"keyword",id:"keyword",level:2}],p={toc:c};function u(e){let{components:n,...r}=e;return(0,o.kt)("wrapper",(0,t.Z)({},p,r,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"outfile"},"OUTFILE"),(0,o.kt)("h2",{id:"description"},"description"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'\u8be5\u8bed\u53e5\u7528\u4e8e\u4f7f\u7528 `SELECT INTO OUTFILE` \u547d\u4ee4\u5c06\u67e5\u8be2\u7ed3\u679c\u7684\u5bfc\u51fa\u4e3a\u6587\u4ef6\u3002\u76ee\u524d\u652f\u6301\u901a\u8fc7 Broker \u8fdb\u7a0b, \u901a\u8fc7 S3 \u534f\u8bae, \u6216\u76f4\u63a5\u901a\u8fc7 HDFS \u534f\u8bae\uff0c\u5bfc\u51fa\u5230\u8fdc\u7aef\u5b58\u50a8\uff0c\u5982 HDFS\uff0cS3\uff0cBOS\uff0cCOS\uff08\u817e\u8baf\u4e91\uff09\u4e0a\u3002\n\n\u8bed\u6cd5\uff1a\n    query_stmt\n    INTO OUTFILE "file_path"\n    [format_as]\n    [properties]\n\n1. file_path\n    file_path \u6307\u5411\u6587\u4ef6\u5b58\u50a8\u7684\u8def\u5f84\u4ee5\u53ca\u6587\u4ef6\u524d\u7f00\u3002\u5982 `hdfs://path/to/my_file_`\u3002\n    \u6700\u7ec8\u7684\u6587\u4ef6\u540d\u5c06\u7531 `my_file_`\uff0c\u6587\u4ef6\u5e8f\u53f7\u4ee5\u53ca\u6587\u4ef6\u683c\u5f0f\u540e\u7f00\u7ec4\u6210\u3002\u5176\u4e2d\u6587\u4ef6\u5e8f\u53f7\u75310\u5f00\u59cb\uff0c\u6570\u91cf\u4e3a\u6587\u4ef6\u88ab\u5206\u5272\u7684\u6570\u91cf\u3002\u5982\uff1a\n        my_file_abcdefg_0.csv\n        my_file_abcdefg_1.csv\n        my_file_abcdegf_2.csv\n\n2. format_as\n    FORMAT AS CSV\n    \u6307\u5b9a\u5bfc\u51fa\u683c\u5f0f\u3002\u9ed8\u8ba4\u4e3a CSV\u3002\n\n\n3. properties\n    \u6307\u5b9a\u76f8\u5173\u5c5e\u6027\u3002\u76ee\u524d\u652f\u6301\u901a\u8fc7 Broker \u8fdb\u7a0b, \u6216\u901a\u8fc7 S3 \u534f\u8bae\u8fdb\u884c\u5bfc\u51fa\u3002\n\n    \u8bed\u6cd5\uff1a\n    [PROPERTIES ("key"="value", ...)]\n    \u652f\u6301\u5982\u4e0b\u5c5e\u6027\uff1a\n    column_separator: \u5217\u5206\u9694\u7b26\n    line_delimiter: \u884c\u5206\u9694\u7b26\n    max_file_size: \u5355\u4e2a\u6587\u4ef6\u5927\u5c0f\u9650\u5236\uff0c\u5982\u679c\u7ed3\u679c\u8d85\u8fc7\u8fd9\u4e2a\u503c\uff0c\u5c06\u5207\u5272\u6210\u591a\u4e2a\u6587\u4ef6\u3002\n\n    Broker \u76f8\u5173\u5c5e\u6027\u9700\u52a0\u524d\u7f00 `broker.`:\n    broker.name: broker\u540d\u79f0\n    broker.hadoop.security.authentication: \u6307\u5b9a\u8ba4\u8bc1\u65b9\u5f0f\u4e3a kerberos\n    broker.kerberos_principal: \u6307\u5b9a kerberos \u7684 principal\n    broker.kerberos_keytab: \u6307\u5b9a kerberos \u7684 keytab \u6587\u4ef6\u8def\u5f84\u3002\u8be5\u6587\u4ef6\u5fc5\u987b\u4e3a Broker \u8fdb\u7a0b\u6240\u5728\u670d\u52a1\u5668\u4e0a\u7684\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\u3002\u5e76\u4e14\u53ef\u4ee5\u88ab Broker \u8fdb\u7a0b\u8bbf\u95ee\n\n    HDFS \u76f8\u5173\u5c5e\u6027\u9700\u52a0\u524d\u7f00 `hdfs.`:\n    hdfs.fs.defaultFS: namenode \u5730\u5740\u548c\u7aef\u53e3\n    hdfs.hdfs_user: hdfs \u7528\u6237\u540d\n\n    S3 \u534f\u8bae\u5219\u76f4\u63a5\u6267\u884c S3 \u534f\u8bae\u914d\u7f6e\u5373\u53ef:\n    AWS_ENDPOINT\n    AWS_ACCESS_KEY\n    AWS_SECRET_KEY\n    AWS_REGION\n')),(0,o.kt)("h2",{id:"example"},"example"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'1. \u4f7f\u7528 broker \u65b9\u5f0f\u5bfc\u51fa\uff0c\u5c06\u7b80\u5355\u67e5\u8be2\u7ed3\u679c\u5bfc\u51fa\u5230\u6587\u4ef6 `hdfs://path/to/result.txt`\u3002\u6307\u5b9a\u5bfc\u51fa\u683c\u5f0f\u4e3a CSV\u3002\u4f7f\u7528 `my_broker` \u5e76\u8bbe\u7f6e kerberos \u8ba4\u8bc1\u4fe1\u606f\u3002\u6307\u5b9a\u5217\u5206\u9694\u7b26\u4e3a `,`\uff0c\u884c\u5206\u9694\u7b26\u4e3a `\\n`\u3002\nSELECT * FROM tbl\nINTO OUTFILE "hdfs://path/to/result_"\nFORMAT AS CSV\nPROPERTIES\n(\n    "broker.name" = "my_broker",\n    "broker.hadoop.security.authentication" = "kerberos",\n    "broker.kerberos_principal" = "doris@YOUR.COM",\n    "broker.kerberos_keytab" = "/home/doris/my.keytab",\n    "column_separator" = ",",\n    "line_delimiter" = "\\n",\n    "max_file_size" = "100MB"\n);\n\u6700\u7ec8\u751f\u6210\u6587\u4ef6\u5982\u5982\u679c\u4e0d\u5927\u4e8e 100MB\uff0c\u5219\u4e3a\uff1a`result_0.csv`\u3002\n\u5982\u679c\u5927\u4e8e 100MB\uff0c\u5219\u53ef\u80fd\u4e3a `result_0.csv, result_1.csv, ...`\u3002\n\n2. \u5c06\u7b80\u5355\u67e5\u8be2\u7ed3\u679c\u5bfc\u51fa\u5230\u6587\u4ef6 `hdfs://path/to/result.parquet`\u3002\u6307\u5b9a\u5bfc\u51fa\u683c\u5f0f\u4e3a PARQUET\u3002\u4f7f\u7528 `my_broker` \u5e76\u8bbe\u7f6e kerberos \u8ba4\u8bc1\u4fe1\u606f\u3002\nSELECT c1, c2, c3 FROM tbl\nINTO OUTFILE "hdfs://path/to/result_"\nFORMAT AS PARQUET\nPROPERTIES\n(\n    "broker.name" = "my_broker",\n    "broker.hadoop.security.authentication" = "kerberos",\n    "broker.kerberos_principal" = "doris@YOUR.COM",\n    "broker.kerberos_keytab" = "/home/doris/my.keytab",\n    "schema"="required,int32,c1;required,byte_array,c2;required,byte_array,c2"\n);\n\u67e5\u8be2\u7ed3\u679c\u5bfc\u51fa\u5230parquet\u6587\u4ef6\u9700\u8981\u660e\u786e\u6307\u5b9a`schema`\u3002\n\n3. \u5c06 CTE \u8bed\u53e5\u7684\u67e5\u8be2\u7ed3\u679c\u5bfc\u51fa\u5230\u6587\u4ef6 `hdfs://path/to/result.txt`\u3002\u9ed8\u8ba4\u5bfc\u51fa\u683c\u5f0f\u4e3a CSV\u3002\u4f7f\u7528 `my_broker` \u5e76\u8bbe\u7f6e hdfs \u9ad8\u53ef\u7528\u4fe1\u606f\u3002\u4f7f\u7528\u9ed8\u8ba4\u7684\u884c\u5217\u5206\u9694\u7b26\u3002\nWITH\nx1 AS\n(SELECT k1, k2 FROM tbl1),\nx2 AS\n(SELECT k3 FROM tbl2)\nSELEC k1 FROM x1 UNION SELECT k3 FROM x2\nINTO OUTFILE "hdfs://path/to/result_"\nPROPERTIES\n(\n    "broker.name" = "my_broker",\n    "broker.username"="user",\n    "broker.password"="passwd",\n    "broker.dfs.nameservices" = "my_ha",\n    "broker.dfs.ha.namenodes.my_ha" = "my_namenode1, my_namenode2",\n    "broker.dfs.namenode.rpc-address.my_ha.my_namenode1" = "nn1_host:rpc_port",\n    "broker.dfs.namenode.rpc-address.my_ha.my_namenode2" = "nn2_host:rpc_port",\n    "broker.dfs.client.failover.proxy.provider" = "org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider"\n);\n\u6700\u7ec8\u751f\u6210\u6587\u4ef6\u5982\u5982\u679c\u4e0d\u5927\u4e8e 1GB\uff0c\u5219\u4e3a\uff1a`result_0.csv`\u3002\n\u5982\u679c\u5927\u4e8e 1GB\uff0c\u5219\u53ef\u80fd\u4e3a `result_0.csv, result_1.csv, ...`\u3002\n\n4. \u5c06 UNION \u8bed\u53e5\u7684\u67e5\u8be2\u7ed3\u679c\u5bfc\u51fa\u5230\u6587\u4ef6 `bos://bucket/result.txt`\u3002\u6307\u5b9a\u5bfc\u51fa\u683c\u5f0f\u4e3a PARQUET\u3002\u4f7f\u7528 `my_broker` \u5e76\u8bbe\u7f6e hdfs \u9ad8\u53ef\u7528\u4fe1\u606f\u3002PARQUET \u683c\u5f0f\u65e0\u9700\u6307\u5b9a\u5217\u5206\u5272\u7b26\u3002\n\u5bfc\u51fa\u5b8c\u6210\u540e\uff0c\u751f\u6210\u4e00\u4e2a\u6807\u8bc6\u6587\u4ef6\u3002\nSELECT k1 FROM tbl1 UNION SELECT k2 FROM tbl1\nINTO OUTFILE "bos://bucket/result_"\nFORMAT AS PARQUET\nPROPERTIES\n(\n    "broker.name" = "my_broker",\n    "broker.bos_endpoint" = "http://bj.bcebos.com",\n    "broker.bos_accesskey" = "xxxxxxxxxxxxxxxxxxxxxxxxxx",\n    "broker.bos_secret_accesskey" = "yyyyyyyyyyyyyyyyyyyyyyyyyy",\n    "schema"="required,int32,k1;required,byte_array,k2"\n);\n\n5. \u5c06 select \u8bed\u53e5\u7684\u67e5\u8be2\u7ed3\u679c\u5bfc\u51fa\u5230\u6587\u4ef6 `cos://${bucket_name}/path/result.txt`\u3002\u6307\u5b9a\u5bfc\u51fa\u683c\u5f0f\u4e3a csv\u3002\n\u5bfc\u51fa\u5b8c\u6210\u540e\uff0c\u751f\u6210\u4e00\u4e2a\u6807\u8bc6\u6587\u4ef6\u3002\nselect k1,k2,v1 from tbl1 limit 100000\ninto outfile "s3a://my_bucket/export/my_file_"\nFORMAT AS CSV\nPROPERTIES\n(\n    "broker.name" = "hdfs_broker",\n    "broker.fs.s3a.access.key" = "xxx",\n    "broker.fs.s3a.secret.key" = "xxxx",\n    "broker.fs.s3a.endpoint" = "https://cos.xxxxxx.myqcloud.com/",\n    "column_separator" = ",",\n    "line_delimiter" = "\\n",\n    "max_file_size" = "1024MB",\n    "success_file_name" = "SUCCESS"\n)\n\u6700\u7ec8\u751f\u6210\u6587\u4ef6\u5982\u5982\u679c\u4e0d\u5927\u4e8e 1GB\uff0c\u5219\u4e3a\uff1a`my_file_0.csv`\u3002\n\u5982\u679c\u5927\u4e8e 1GB\uff0c\u5219\u53ef\u80fd\u4e3a `my_file_0.csv, result_1.csv, ...`\u3002\n\u5728cos\u4e0a\u9a8c\u8bc1\n    1. \u4e0d\u5b58\u5728\u7684path\u4f1a\u81ea\u52a8\u521b\u5efa\n    2. access.key/secret.key/endpoint\u9700\u8981\u548ccos\u7684\u540c\u5b66\u786e\u8ba4\u3002\u5c24\u5176\u662fendpoint\u7684\u503c\uff0c\u4e0d\u9700\u8981\u586b\u5199bucket_name\u3002\n\n6. \u4f7f\u7528 s3 \u534f\u8bae\u5bfc\u51fa\u5230 bos\uff0c\u5e76\u4e14\u5e76\u53d1\u5bfc\u51fa\u5f00\u542f\u3002\nset enable_parallel_outfile = true;\nselect k1 from tb1 limit 1000\ninto outfile "s3://my_bucket/export/my_file_"\nformat as csv\nproperties\n(\n    "AWS_ENDPOINT" = "http://s3.bd.bcebos.com",\n    "AWS_ACCESS_KEY" = "xxxx",\n    "AWS_SECRET_KEY" = "xxx",\n    "AWS_REGION" = "bd"\n)\n\u6700\u7ec8\u751f\u6210\u7684\u6587\u4ef6\u524d\u7f00\u4e3a `my_file_{fragment_instance_id}_`\u3002\n\n7. \u4f7f\u7528 s3 \u534f\u8bae\u5bfc\u51fa\u5230 bos\uff0c\u5e76\u4e14\u5e76\u53d1\u5bfc\u51fa session \u53d8\u91cf\u5f00\u542f\u3002\n\u6ce8\u610f\uff1a\u4f46\u7531\u4e8e\u67e5\u8be2\u8bed\u53e5\u5e26\u4e86\u4e00\u4e2a\u9876\u5c42\u7684\u6392\u5e8f\u8282\u70b9\uff0c\u6240\u4ee5\u8fd9\u4e2a\u67e5\u8be2\u5373\u4f7f\u5f00\u542f\u5e76\u53d1\u5bfc\u51fa\u7684 session \u53d8\u91cf\uff0c\u4e5f\u662f\u65e0\u6cd5\u5e76\u53d1\u5bfc\u51fa\u7684\u3002\nset enable_parallel_outfile = true;\nselect k1 from tb1 order by k1 limit 1000\ninto outfile "s3://my_bucket/export/my_file_"\nformat as csv\nproperties\n(\n    "AWS_ENDPOINT" = "http://s3.bd.bcebos.com",\n    "AWS_ACCESS_KEY" = "xxxx",\n    "AWS_SECRET_KEY" = "xxx",\n    "AWS_REGION" = "bd"\n)\n\n8. \u4f7f\u7528 hdfs \u65b9\u5f0f\u5bfc\u51fa\uff0c\u5c06\u7b80\u5355\u67e5\u8be2\u7ed3\u679c\u5bfc\u51fa\u5230\u6587\u4ef6 `hdfs://path/to/result.txt`\u3002\u6307\u5b9a\u5bfc\u51fa\u683c\u5f0f\u4e3a CSV\uff0c\u7528\u6237\u540d\u4e3awork\u3002\u6307\u5b9a\u5217\u5206\u9694\u7b26\u4e3a `,`\uff0c\u884c\u5206\u9694\u7b26\u4e3a `\\n`\u3002\nSELECT * FROM tbl\nINTO OUTFILE "hdfs://path/to/result_"\nFORMAT AS CSV\nPROPERTIES\n(\n    "hdfs.fs.defaultFS" = "hdfs://ip:port",\n    "hdfs.hdfs_user" = "work"\n);\n\u6700\u7ec8\u751f\u6210\u6587\u4ef6\u5982\u5982\u679c\u4e0d\u5927\u4e8e 100MB\uff0c\u5219\u4e3a\uff1a`result_0.csv`\u3002\n\u5982\u679c\u5927\u4e8e 100MB\uff0c\u5219\u53ef\u80fd\u4e3a `result_0.csv, result_1.csv, ...`\u3002\n')),(0,o.kt)("h2",{id:"keyword"},"keyword"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"OUTFILE\n")))}u.isMDXComponent=!0}}]);