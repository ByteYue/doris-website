(window.webpackJsonp=window.webpackJsonp||[]).push([[4085],{4715:function(t,s,a){"use strict";a.r(s);var n=a(15),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"导入严格模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导入严格模式"}},[t._v("#")]),t._v(" 导入严格模式")]),t._v(" "),a("p",[t._v("严格模式（strict_mode）为导入操作中的一个参数配置。该参数会影响某些数值的导入行为和最终导入的数据。")]),t._v(" "),a("p",[t._v("本文档主要说明如何设置严格模式，以及严格模式产生的影响。")]),t._v(" "),a("h2",{attrs:{id:"如何设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何设置"}},[t._v("#")]),t._v(" 如何设置")]),t._v(" "),a("p",[t._v("严格模式默认情况下都为 False，即关闭状态。")]),t._v(" "),a("p",[t._v("不同的导入方式设置严格模式的方式不尽相同。")]),t._v(" "),a("ol",[a("li",[a("p",[a("RouterLink",{attrs:{to:"/zh-CN/docs/sql-manual/sql-reference/Data-Manipulation-Statements/Load/BROKER-LOAD.html"}},[t._v("BROKER LOAD")])],1),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LOAD")]),t._v(" LABEL example_db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("label1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DATA")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INFILE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bos://my_bucket/input/file.txt"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INTO")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")]),t._v("my_table"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("`")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COLUMNS")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TERMINATED")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("BY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('","')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WITH")]),t._v(" BROKER bos\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bos_endpoint"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://bj.bcebos.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bos_accesskey"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxxxxxxxxxxxxxxxxxxxxxxxx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bos_secret_accesskey"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yyyyyyyyyyyyyyyyyyyyyyyyyy"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nPROPERTIES\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"strict_mode"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br")])])]),t._v(" "),a("li",[a("p",[a("RouterLink",{attrs:{to:"/zh-CN/docs/sql-manual/sql-reference/Data-Manipulation-Statements/Load/STREAM-LOAD.html"}},[t._v("STREAM LOAD")])],1),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" --location-trusted -u user:passwd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-H "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"strict_mode: true"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n-T "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(".txt "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\nhttp://host:port/api/example_db/my_table/_stream_load\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])])]),t._v(" "),a("li",[a("p",[a("RouterLink",{attrs:{to:"/zh-CN/docs/sql-manual/sql-reference/Data-Manipulation-Statements/Load/CREATE-ROUTINE-LOAD.html"}},[t._v("ROUTINE LOAD")])],1),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ROUTINE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LOAD")]),t._v(" example_db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("test_job "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" my_table\nPROPERTIES\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"strict_mode"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" KAFKA\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kafka_broker_list"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"broker1:9092,broker2:9092,broker3:9092"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kafka_topic"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my_topic"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])])]),t._v(" "),a("li",[a("p",[a("RouterLink",{attrs:{to:"/zh-CN/docs/sql-manual/sql-reference/Data-Manipulation-Statements/Manipulation/INSERT.html"}},[t._v("INSERT")])],1),t._v(" "),a("p",[t._v("通过"),a("RouterLink",{attrs:{to:"/zh-CN/docs/advanced/variables.html"}},[t._v("会话变量")]),t._v("设置：")],1),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SET")]),t._v(" enable_insert_strict "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INSERT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("INTO")]),t._v(" my_table "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])])])]),t._v(" "),a("h2",{attrs:{id:"严格模式的作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#严格模式的作用"}},[t._v("#")]),t._v(" 严格模式的作用")]),t._v(" "),a("p",[t._v("严格模式的意思是，对于导入过程中的列类型转换进行严格过滤。")]),t._v(" "),a("p",[t._v("严格过滤的策略如下：")]),t._v(" "),a("p",[t._v("对于列类型转换来说，如果开启严格模式，则错误的数据将被过滤。这里的错误数据是指：原始数据并不为 "),a("code",[t._v("null")]),t._v("，而在进行列类型转换后结果为 "),a("code",[t._v("null")]),t._v(" 的这一类数据。")]),t._v(" "),a("p",[t._v("这里说指的 "),a("code",[t._v("列类型转换")]),t._v("，并不包括用函数计算得出的 "),a("code",[t._v("null")]),t._v(" 值。")]),t._v(" "),a("p",[t._v("对于导入的某列类型包含范围限制的，如果原始数据能正常通过类型转换，但无法通过范围限制的，严格模式对其也不产生影响。例如：如果类型是 "),a("code",[t._v("decimal(1,0)")]),t._v(", 原始数据为 10，则属于可以通过类型转换但不在列声明的范围内。这种数据 strict 对其不产生影响。")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("以列类型为 TinyInt 来举例：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("原始数据类型")]),t._v(" "),a("th",[t._v("原始数据举例")]),t._v(" "),a("th",[t._v("转换为 TinyInt 后的值")]),t._v(" "),a("th",[t._v("严格模式")]),t._v(" "),a("th",[t._v("结果")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("空值")]),t._v(" "),a("td",[t._v("\\N")]),t._v(" "),a("td",[t._v("NULL")]),t._v(" "),a("td",[t._v("开启或关闭")]),t._v(" "),a("td",[t._v("NULL")])]),t._v(" "),a("tr",[a("td",[t._v("非空值")]),t._v(" "),a("td",[t._v('"abc" or 2000')]),t._v(" "),a("td",[t._v("NULL")]),t._v(" "),a("td",[t._v("开启")]),t._v(" "),a("td",[t._v("非法值（被过滤）")])]),t._v(" "),a("tr",[a("td",[t._v("非空值")]),t._v(" "),a("td",[t._v('"abc"')]),t._v(" "),a("td",[t._v("NULL")]),t._v(" "),a("td",[t._v("关闭")]),t._v(" "),a("td",[t._v("NULL")])]),t._v(" "),a("tr",[a("td",[t._v("非空值")]),t._v(" "),a("td",[t._v("1")]),t._v(" "),a("td",[t._v("1")]),t._v(" "),a("td",[t._v("开启或关闭")]),t._v(" "),a("td",[t._v("正确导入")])])])]),t._v(" "),a("blockquote",[a("p",[t._v("说明：")]),t._v(" "),a("ol",[a("li",[t._v("表中的列允许导入空值")]),t._v(" "),a("li",[a("code",[t._v("abc")]),t._v(" 及 "),a("code",[t._v("2000")]),t._v(" 在转换为 TinyInt 后，会因类型或精度问题变为 NULL。在严格模式开启的情况下，这类数据将会被过滤。而如果是关闭状态，则会导入 "),a("code",[t._v("null")]),t._v("。")])])])]),t._v(" "),a("li",[a("p",[t._v("以列类型为 Decimal(1,0) 举例")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("原始数据类型")]),t._v(" "),a("th",[t._v("原始数据举例")]),t._v(" "),a("th",[t._v("转换为 Decimal 后的值")]),t._v(" "),a("th",[t._v("严格模式")]),t._v(" "),a("th",[t._v("结果")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("空值")]),t._v(" "),a("td",[t._v("\\N")]),t._v(" "),a("td",[t._v("null")]),t._v(" "),a("td",[t._v("开启或关闭")]),t._v(" "),a("td",[t._v("NULL")])]),t._v(" "),a("tr",[a("td",[t._v("非空值")]),t._v(" "),a("td",[t._v("aaa")]),t._v(" "),a("td",[t._v("NULL")]),t._v(" "),a("td",[t._v("开启")]),t._v(" "),a("td",[t._v("非法值（被过滤）")])]),t._v(" "),a("tr",[a("td",[t._v("非空值")]),t._v(" "),a("td",[t._v("aaa")]),t._v(" "),a("td",[t._v("NULL")]),t._v(" "),a("td",[t._v("关闭")]),t._v(" "),a("td",[t._v("NULL")])]),t._v(" "),a("tr",[a("td",[t._v("非空值")]),t._v(" "),a("td",[t._v("1 or 10")]),t._v(" "),a("td",[t._v("1 or 10")]),t._v(" "),a("td",[t._v("开启或关闭")]),t._v(" "),a("td",[t._v("正确导入")])])])]),t._v(" "),a("blockquote",[a("p",[t._v("说明：")]),t._v(" "),a("ol",[a("li",[t._v("表中的列允许导入空值")]),t._v(" "),a("li",[a("code",[t._v("abc")]),t._v(" 在转换为 Decimal 后，会因类型问题变为 NULL。在严格模式开启的情况下，这类数据将会被过滤。而如果是关闭状态，则会导入 "),a("code",[t._v("null")]),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("10")]),t._v(" 虽然是一个超过范围的值，但是因为其类型符合 decimal 的要求，所以严格模式对其不产生影响。"),a("code",[t._v("10")]),t._v(" 最后会在其他导入处理流程中被过滤。但不会被严格模式过滤。")])])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);