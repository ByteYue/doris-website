(window.webpackJsonp=window.webpackJsonp||[]).push([[3474],{4104:function(s,t,a){"use strict";a.r(t);var n=a(15),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"动态分区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态分区"}},[s._v("#")]),s._v(" 动态分区")]),s._v(" "),a("p",[s._v("动态分区是在 Doris 0.12 版本中引入的新功能。旨在对表级别的分区实现生命周期管理(TTL)，减少用户的使用负担。")]),s._v(" "),a("p",[s._v("目前实现了动态添加分区及动态删除分区的功能。")]),s._v(" "),a("p",[s._v("动态分区只支持 Range 分区。")]),s._v(" "),a("h2",{attrs:{id:"原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[s._v("#")]),s._v(" 原理")]),s._v(" "),a("p",[s._v("在某些使用场景下，用户会将表按照天进行分区划分，每天定时执行例行任务，这时需要使用方手动管理分区，否则可能由于使用方没有创建分区导致数据导入失败，这给使用方带来了额外的维护成本。")]),s._v(" "),a("p",[s._v("通过动态分区功能，用户可以在建表时设定动态分区的规则。FE 会启动一个后台线程，根据用户指定的规则创建或删除分区。用户也可以在运行时对现有规则进行变更。")]),s._v(" "),a("h2",{attrs:{id:"使用方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用方式"}},[s._v("#")]),s._v(" 使用方式")]),s._v(" "),a("p",[s._v("动态分区的规则可以在建表时指定，或者在运行时进行修改。当前仅支持对单分区列的分区表设定动态分区规则。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("建表时指定：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" tbl1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nPROPERTIES\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.prop1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.prop2"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("运行时修改")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" tbl1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.prop1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.prop2"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"动态分区规则参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态分区规则参数"}},[s._v("#")]),s._v(" 动态分区规则参数")]),s._v(" "),a("p",[s._v("动态分区的规则参数都以 "),a("code",[s._v("dynamic_partition.")]),s._v(" 为前缀：")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("dynamic_partition.enable")])]),s._v(" "),a("p",[s._v("是否开启动态分区特性。可指定为 "),a("code",[s._v("TRUE")]),s._v(" 或 "),a("code",[s._v("FALSE")]),s._v("。如果不填写，默认为 "),a("code",[s._v("TRUE")]),s._v("。如果为 "),a("code",[s._v("FALSE")]),s._v("，则 Doris 会忽略该表的动态分区规则。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("dynamic_partition.time_unit")])]),s._v(" "),a("p",[s._v("动态分区调度的单位。可指定为 "),a("code",[s._v("HOUR")]),s._v("、"),a("code",[s._v("DAY")]),s._v("、"),a("code",[s._v("WEEK")]),s._v("、"),a("code",[s._v("MONTH")]),s._v("。分别表示按小时、按天、按星期、按月进行分区创建或删除。")]),s._v(" "),a("p",[s._v("当指定为 "),a("code",[s._v("HOUR")]),s._v(" 时，动态创建的分区名后缀格式为 "),a("code",[s._v("yyyyMMddHH")]),s._v("，例如"),a("code",[s._v("2020032501")]),s._v("。小时为单位的分区列数据类型不能为 DATE。")]),s._v(" "),a("p",[s._v("当指定为 "),a("code",[s._v("DAY")]),s._v(" 时，动态创建的分区名后缀格式为 "),a("code",[s._v("yyyyMMdd")]),s._v("，例如"),a("code",[s._v("20200325")]),s._v("。")]),s._v(" "),a("p",[s._v("当指定为 "),a("code",[s._v("WEEK")]),s._v(" 时，动态创建的分区名后缀格式为"),a("code",[s._v("yyyy_ww")]),s._v("。即当前日期属于这一年的第几周，例如 "),a("code",[s._v("2020-03-25")]),s._v(" 创建的分区名后缀为 "),a("code",[s._v("2020_13")]),s._v(", 表明目前为2020年第13周。")]),s._v(" "),a("p",[s._v("当指定为 "),a("code",[s._v("MONTH")]),s._v(" 时，动态创建的分区名后缀格式为 "),a("code",[s._v("yyyyMM")]),s._v("，例如 "),a("code",[s._v("202003")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("dynamic_partition.time_zone")])]),s._v(" "),a("p",[s._v("动态分区的时区，如果不填写，则默认为当前机器的系统的时区，例如 "),a("code",[s._v("Asia/Shanghai")]),s._v("，如果想获取当前支持的时区设置，可以参考 "),a("code",[s._v("https://en.wikipedia.org/wiki/List_of_tz_database_time_zones")]),s._v("。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("dynamic_partition.start")])]),s._v(" "),a("p",[s._v("动态分区的起始偏移，为负数。根据 "),a("code",[s._v("time_unit")]),s._v(" 属性的不同，以当天（星期/月）为基准，分区范围在此偏移之前的分区将会被删除。如果不填写，则默认为 "),a("code",[s._v("-2147483648")]),s._v("，即不删除历史分区。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("dynamic_partition.end")])]),s._v(" "),a("p",[s._v("动态分区的结束偏移，为正数。根据 "),a("code",[s._v("time_unit")]),s._v(" 属性的不同，以当天（星期/月）为基准，提前创建对应范围的分区。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("dynamic_partition.prefix")])]),s._v(" "),a("p",[s._v("动态创建的分区名前缀。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("dynamic_partition.buckets")])]),s._v(" "),a("p",[s._v("动态创建的分区所对应的分桶数量。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("dynamic_partition.replication_num")])]),s._v(" "),a("p",[s._v("动态创建的分区所对应的副本数量，如果不填写，则默认为该表创建时指定的副本数量。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("dynamic_partition.start_day_of_week")])]),s._v(" "),a("p",[s._v("当 "),a("code",[s._v("time_unit")]),s._v(" 为 "),a("code",[s._v("WEEK")]),s._v(" 时，该参数用于指定每周的起始点。取值为 1 到 7。其中 1 表示周一，7 表示周日。默认为 1，即表示每周以周一为起始点。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("dynamic_partition.start_day_of_month")])]),s._v(" "),a("p",[s._v("当 "),a("code",[s._v("time_unit")]),s._v(" 为 "),a("code",[s._v("MONTH")]),s._v(" 时，该参数用于指定每月的起始日期。取值为 1 到 28。其中 1 表示每月1号，28 表示每月28号。默认为 1，即表示每月以1号位起始点。暂不支持以29、30、31号为起始日，以避免因闰年或闰月带来的歧义。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("dynamic_partition.create_history_partition")])]),s._v(" "),a("p",[s._v("默认为 false。当置为 true 时，Doris 会自动创建所有分区，具体创建规则见下文。同时，FE 的参数 "),a("code",[s._v("max_dynamic_partition_num")]),s._v(" 会限制总分区数量，以避免一次性创建过多分区。当期望创建的分区个数大于 "),a("code",[s._v("max_dynamic_partition_num")]),s._v(" 值时，操作将被禁止。")]),s._v(" "),a("p",[s._v("当不指定 "),a("code",[s._v("start")]),s._v(" 属性时，该参数不生效。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("dynamic_partition.history_partition_num")])]),s._v(" "),a("p",[s._v("当 "),a("code",[s._v("create_history_partition")]),s._v(" 为 "),a("code",[s._v("true")]),s._v(" 时，该参数用于指定创建历史分区数量。默认值为 -1， 即未设置。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("dynamic_partition.hot_partition_num")])]),s._v(" "),a("p",[s._v("指定最新的多少个分区为热分区。对于热分区，系统会自动设置其 "),a("code",[s._v("storage_medium")]),s._v(" 参数为SSD，并且设置 "),a("code",[s._v("storage_cooldown_time")]),s._v("。")]),s._v(" "),a("p",[a("code",[s._v("hot_partition_num")]),s._v(" 是往前 n 天和未来所有分区")]),s._v(" "),a("p",[s._v("我们举例说明。假设今天是 2021-05-20，按天分区，动态分区的属性设置为：hot_partition_num=2, end=3, start=-3。则系统会自动创建以下分区，并且设置 "),a("code",[s._v("storage_medium")]),s._v(" 和 "),a("code",[s._v("storage_cooldown_time")]),s._v(" 参数：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('p20210517：["2021-05-17", "2021-05-18") storage_medium=HDD storage_cooldown_time=9999-12-31 23:59:59\np20210518：["2021-05-18", "2021-05-19") storage_medium=HDD storage_cooldown_time=9999-12-31 23:59:59\np20210519：["2021-05-19", "2021-05-20") storage_medium=SSD storage_cooldown_time=2021-05-21 00:00:00\np20210520：["2021-05-20", "2021-05-21") storage_medium=SSD storage_cooldown_time=2021-05-22 00:00:00\np20210521：["2021-05-21", "2021-05-22") storage_medium=SSD storage_cooldown_time=2021-05-23 00:00:00\np20210522：["2021-05-22", "2021-05-23") storage_medium=SSD storage_cooldown_time=2021-05-24 00:00:00\np20210523：["2021-05-23", "2021-05-24") storage_medium=SSD storage_cooldown_time=2021-05-25 00:00:00\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("dynamic_partition.reserved_history_periods")])]),s._v(" "),a("p",[s._v("需要保留的历史分区的时间范围。当"),a("code",[s._v("dynamic_partition.time_unit")]),s._v(' 设置为 "DAY/WEEK/MONTH" 时，需要以 '),a("code",[s._v("[yyyy-MM-dd,yyyy-MM-dd],[...,...]")]),s._v(" 格式进行设置。当"),a("code",[s._v("dynamic_partition.time_unit")]),s._v(' 设置为 "HOUR" 时，需要以 '),a("code",[s._v("[yyyy-MM-dd HH:mm:ss,yyyy-MM-dd HH:mm:ss],[...,...]")]),s._v(" 的格式来进行设置。如果不设置，默认为 "),a("code",[s._v('"NULL"')]),s._v("。")]),s._v(" "),a("p",[s._v("我们举例说明。假设今天是 2021-09-06，按天分类，动态分区的属性设置为：")]),s._v(" "),a("p",[a("code",[s._v('time_unit="DAY/WEEK/MONTH", end=3, start=-3, reserved_history_periods="[2020-06-01,2020-06-20],[2020-10-31,2020-11-15]"')]),s._v("。")]),s._v(" "),a("p",[s._v("则系统会自动保留：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('["2020-06-01","2020-06-20"],\n["2020-10-31","2020-11-15"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("或者")]),s._v(" "),a("p",[a("code",[s._v('time_unit="HOUR", end=3, start=-3, reserved_history_periods="[2020-06-01 00:00:00,2020-06-01 03:00:00]"')]),s._v(".")]),s._v(" "),a("p",[s._v("则系统会自动保留：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('["2020-06-01 00:00:00","2020-06-01 03:00:00"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这两个时间段的分区。其中，"),a("code",[s._v("reserved_history_periods")]),s._v(" 的每一个 "),a("code",[s._v("[...,...]")]),s._v(" 是一对设置项，两者需要同时被设置，且第一个时间不能大于第二个时间。")])])]),s._v(" "),a("h4",{attrs:{id:"创建历史分区规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建历史分区规则"}},[s._v("#")]),s._v(" 创建历史分区规则")]),s._v(" "),a("p",[s._v("当 "),a("code",[s._v("create_history_partition")]),s._v(" 为 "),a("code",[s._v("true")]),s._v("，即开启创建历史分区功能时，Doris 会根据 "),a("code",[s._v("dynamic_partition.start")]),s._v(" 和 "),a("code",[s._v("dynamic_partition.history_partition_num")]),s._v(" 来决定创建历史分区的个数。")]),s._v(" "),a("p",[s._v("假设需要创建的历史分区数量为 "),a("code",[s._v("expect_create_partition_num")]),s._v("，根据不同的设置具体数量如下：")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("create_history_partition")]),s._v(" = "),a("code",[s._v("true")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("dynamic_partition.history_partition_num")]),s._v(" 未设置，即 -1.\n"),a("code",[s._v("expect_create_partition_num")]),s._v(" = "),a("code",[s._v("end")]),s._v(" - "),a("code",[s._v("start")]),s._v(";")]),s._v(" "),a("li",[a("code",[s._v("dynamic_partition.history_partition_num")]),s._v(" 已设置\n"),a("code",[s._v("expect_create_partition_num")]),s._v(" = "),a("code",[s._v("end")]),s._v(" - max("),a("code",[s._v("start")]),s._v(", "),a("code",[s._v("-histoty_partition_num")]),s._v(");")])])]),s._v(" "),a("li",[a("code",[s._v("create_history_partition")]),s._v(" = "),a("code",[s._v("false")]),s._v("\n不会创建历史分区，"),a("code",[s._v("expect_create_partition_num")]),s._v(" = "),a("code",[s._v("end")]),s._v(" - 0;")])]),s._v(" "),a("p",[s._v("当 "),a("code",[s._v("expect_create_partition_num")]),s._v(" 大于 "),a("code",[s._v("max_dynamic_partition_num")]),s._v("（默认500）时，禁止创建过多分区。")]),s._v(" "),a("p",[a("strong",[s._v("举例说明：")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("假设今天是 2021-05-20，按天分区，动态分区的属性设置为："),a("code",[s._v("create_history_partition=true, end=3, start=-3, history_partition_num=1")]),s._v("，则系统会自动创建以下分区：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("p20210519\np20210520\np20210521\np20210522\np20210523\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("history_partition_num=5")]),s._v("，其余属性与 1 中保持一直，则系统会自动创建以下分区：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("p20210517\np20210518\np20210519\np20210520\np20210521\np20210522\np20210523\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("history_partition_num=-1")]),s._v(" 即不设置历史分区数量，其余属性与 1 中保持一直，则系统会自动创建以下分区：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("p20210517\np20210518\np20210519\np20210520\np20210521\np20210522\np20210523\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[s._v("#")]),s._v(" 注意事项")]),s._v(" "),a("p",[s._v("动态分区使用过程中，如果因为一些意外情况导致 "),a("code",[s._v("dynamic_partition.start")]),s._v(" 和 "),a("code",[s._v("dynamic_partition.end")]),s._v(" 之间的某些分区丢失，那么当前时间与 "),a("code",[s._v("dynamic_partition.end")]),s._v(" 之间的丢失分区会被重新创建，"),a("code",[s._v("dynamic_partition.start")]),s._v("与当前时间之间的丢失分区不会重新创建。")]),s._v(" "),a("h2",{attrs:{id:"示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[s._v("#")]),s._v(" 示例")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("表 tbl1 分区列 k1 类型为 DATE，创建一个动态分区规则。按天分区，只保留最近7天的分区，并且预先创建未来3天的分区。")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" tbl1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    k1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DATE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" RANGE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DISTRIBUTED")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("HASH")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nPROPERTIES\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.enable"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.time_unit"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DAY"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.start"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-7"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.end"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.prefix"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.buckets"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"32"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("假设当前日期为 2020-05-29。则根据以上规则，tbl1 会产生以下分区：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('p20200529: ["2020-05-29", "2020-05-30")\np20200530: ["2020-05-30", "2020-05-31")\np20200531: ["2020-05-31", "2020-06-01")\np20200601: ["2020-06-01", "2020-06-02")\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("在第二天，即 2020-05-30，会创建新的分区 "),a("code",[s._v('p20200602: ["2020-06-02", "2020-06-03")')])]),s._v(" "),a("p",[s._v("在 2020-06-06 时，因为 "),a("code",[s._v("dynamic_partition.start")]),s._v(" 设置为 7，则将删除7天前的分区，即删除分区 "),a("code",[s._v("p20200529")]),s._v("。")])]),s._v(" "),a("li",[a("p",[s._v("表 tbl1 分区列 k1 类型为 DATETIME，创建一个动态分区规则。按星期分区，只保留最近2个星期的分区，并且预先创建未来2个星期的分区。")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" tbl1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    k1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DATETIME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" RANGE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DISTRIBUTED")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("HASH")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nPROPERTIES\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.enable"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.time_unit"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"WEEK"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.start"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.end"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.prefix"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.buckets"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("假设当前日期为 2020-05-29，是 2020 年的第 22 周。默认每周起始为星期一。则根于以上规则，tbl1 会产生以下分区：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('p2020_22: ["2020-05-25 00:00:00", "2020-06-01 00:00:00")\np2020_23: ["2020-06-01 00:00:00", "2020-06-08 00:00:00")\np2020_24: ["2020-06-08 00:00:00", "2020-06-15 00:00:00")\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("其中每个分区的起始日期为当周的周一。同时，因为分区列 k1 的类型为 DATETIME，则分区值会补全时分秒部分，且皆为 0。")]),s._v(" "),a("p",[s._v("在 2020-06-15，即第25周时，会删除2周前的分区，即删除 "),a("code",[s._v("p2020_22")]),s._v("。")]),s._v(" "),a("p",[s._v("在上面的例子中，假设用户指定了周起始日为 "),a("code",[s._v('"dynamic_partition.start_day_of_week" = "3"')]),s._v("，即以每周三为起始日。则分区如下：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('p2020_22: ["2020-05-27 00:00:00", "2020-06-03 00:00:00")\np2020_23: ["2020-06-03 00:00:00", "2020-06-10 00:00:00")\np2020_24: ["2020-06-10 00:00:00", "2020-06-17 00:00:00")\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("即分区范围为当周的周三到下周的周二。")]),s._v(" "),a("ul",[a("li",[s._v("注：2019-12-31 和 2020-01-01 在同一周内，如果分区的起始日期为 2019-12-31，则分区名为 "),a("code",[s._v("p2019_53")]),s._v("，如果分区的起始日期为 2020-01-01，则分区名为 "),a("code",[s._v("p2020_01")]),s._v("。")])])]),s._v(" "),a("li",[a("p",[s._v("表 tbl1 分区列 k1 类型为 DATE，创建一个动态分区规则。按月分区，不删除历史分区，并且预先创建未来2个月的分区。同时设定以每月3号为起始日。")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" tbl1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    k1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DATE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" RANGE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DISTRIBUTED")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("HASH")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nPROPERTIES\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.enable"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.time_unit"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MONTH"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.end"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.prefix"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.buckets"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.start_day_of_month"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("假设当前日期为 2020-05-29。则根于以上规则，tbl1 会产生以下分区：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('p202005: ["2020-05-03", "2020-06-03")\np202006: ["2020-06-03", "2020-07-03")\np202007: ["2020-07-03", "2020-08-03")\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("因为没有设置 "),a("code",[s._v("dynamic_partition.start")]),s._v("，则不会删除历史分区。")]),s._v(" "),a("p",[s._v("假设今天为 2020-05-20，并设置以每月28号为起始日，则分区范围为：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('p202004: ["2020-04-28", "2020-05-28")\np202005: ["2020-05-28", "2020-06-28")\np202006: ["2020-06-28", "2020-07-28")\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])])]),s._v(" "),a("h2",{attrs:{id:"修改动态分区属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改动态分区属性"}},[s._v("#")]),s._v(" 修改动态分区属性")]),s._v(" "),a("p",[s._v("通过如下命令可以修改动态分区的属性：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" tbl1 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dynamic_partition.prop1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("某些属性的修改可能会产生冲突。假设之前分区粒度为 DAY，并且已经创建了如下分区：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('p20200519: ["2020-05-19", "2020-05-20")\np20200520: ["2020-05-20", "2020-05-21")\np20200521: ["2020-05-21", "2020-05-22")\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("如果此时将分区粒度改为 MONTH，则系统会尝试创建范围为 "),a("code",[s._v('["2020-05-01", "2020-06-01")')]),s._v(" 的分区，而该分区的分区范围和已有分区冲突，所以无法创建。而范围为 "),a("code",[s._v('["2020-06-01", "2020-07-01")')]),s._v(" 的分区可以正常创建。因此，2020-05-22 到 2020-05-30 时间段的分区，需要自行填补。")]),s._v(" "),a("h3",{attrs:{id:"查看动态分区表调度情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看动态分区表调度情况"}},[s._v("#")]),s._v(" 查看动态分区表调度情况")]),s._v(" "),a("p",[s._v("通过以下命令可以进一步查看当前数据库下，所有动态分区表的调度情况：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" DYNAMIC "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLES")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------+--------+----------+-------------+------+--------+---------+-----------+----------------+---------------------+--------+------------------------+----------------------+-------------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" TableName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Enable")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" TimeUnit "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Start")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("End")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Prefix "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Buckets "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" StartOf   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" LastUpdateTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" LastSchedulerTime   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" State  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" LastCreatePartitionMsg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" LastDropPartitionMsg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ReservedHistoryPeriods  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------+--------+----------+-------------+------+--------+---------+-----------+----------------+---------------------+--------+------------------------+----------------------+-------------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" d3        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" WEEK     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" p      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" MONDAY    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NORMAL "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A                  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" d5        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DAY")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" p      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NORMAL "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A                  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" d4        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" WEEK     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" p      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" WEDNESDAY "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NORMAL "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A                  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" d6        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MONTH")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2147483648")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" p      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("rd       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NORMAL "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A                  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" d2        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DAY")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" p      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NORMAL "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A                  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" d7        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MONTH")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2147483648")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" p      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("th      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NORMAL "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" N"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("A                  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-----------+--------+----------+-------------+------+--------+---------+-----------+----------------+---------------------+--------+------------------------+----------------------+-------------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.02")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("ul",[a("li",[s._v("LastUpdateTime: 最后一次修改动态分区属性的时间")]),s._v(" "),a("li",[s._v("LastSchedulerTime: 最后一次执行动态分区调度的时间")]),s._v(" "),a("li",[s._v("State: 最后一次执行动态分区调度的状态")]),s._v(" "),a("li",[s._v("LastCreatePartitionMsg: 最后一次执行动态添加分区调度的错误信息")]),s._v(" "),a("li",[s._v("LastDropPartitionMsg: 最后一次执行动态删除分区调度的错误信息")])]),s._v(" "),a("h2",{attrs:{id:"高级操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#高级操作"}},[s._v("#")]),s._v(" 高级操作")]),s._v(" "),a("h3",{attrs:{id:"fe-配置项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fe-配置项"}},[s._v("#")]),s._v(" FE 配置项")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("dynamic_partition_enable")]),s._v(" "),a("p",[s._v("是否开启 Doris 的动态分区功能。默认为 false，即关闭。该参数只影响动态分区表的分区操作，不影响普通表。可以通过修改 fe.conf 中的参数并重启 FE 生效。也可以在运行时执行以下命令生效：")]),s._v(" "),a("p",[s._v("MySQL 协议：")]),s._v(" "),a("p",[a("code",[s._v('ADMIN SET FRONTEND CONFIG ("dynamic_partition_enable" = "true")')])]),s._v(" "),a("p",[s._v("HTTP 协议：")]),s._v(" "),a("p",[a("code",[s._v("curl --location-trusted -u username:password -XGET http://fe_host:fe_http_port/api/_set_config?dynamic_partition_enable=true")])]),s._v(" "),a("p",[s._v("若要全局关闭动态分区，则设置此参数为 false 即可。")])]),s._v(" "),a("li",[a("p",[s._v("dynamic_partition_check_interval_seconds")]),s._v(" "),a("p",[s._v("动态分区线程的执行频率，默认为600(10分钟)，即每10分钟进行一次调度。可以通过修改 fe.conf 中的参数并重启 FE 生效。也可以在运行时执行以下命令修改：")]),s._v(" "),a("p",[s._v("MySQL 协议：")]),s._v(" "),a("p",[a("code",[s._v('ADMIN SET FRONTEND CONFIG ("dynamic_partition_check_interval_seconds" = "7200")')])]),s._v(" "),a("p",[s._v("HTTP 协议：")]),s._v(" "),a("p",[a("code",[s._v("curl --location-trusted -u username:password -XGET http://fe_host:fe_http_port/api/_set_config?dynamic_partition_check_interval_seconds=432000")])]),s._v(" "),a("h3",{attrs:{id:"动态分区表与手动分区表相互转换"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态分区表与手动分区表相互转换"}},[s._v("#")]),s._v(" 动态分区表与手动分区表相互转换")]),s._v(" "),a("p",[s._v("对于一个表来说，动态分区和手动分区可以自由转换，但二者不能同时存在，有且只有一种状态。")]),s._v(" "),a("h4",{attrs:{id:"手动分区转换为动态分区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手动分区转换为动态分区"}},[s._v("#")]),s._v(" 手动分区转换为动态分区")]),s._v(" "),a("p",[s._v("如果一个表在创建时未指定动态分区，可以通过 "),a("code",[s._v("ALTER TABLE")]),s._v(" 在运行时修改动态分区相关属性来转化为动态分区，具体示例可以通过 "),a("code",[s._v("HELP ALTER TABLE")]),s._v(" 查看。")]),s._v(" "),a("p",[s._v("开启动态分区功能后，Doris 将不再允许用户手动管理分区，会根据动态分区属性来自动管理分区。")]),s._v(" "),a("p",[a("strong",[s._v("注意")]),s._v("：如果已设定 "),a("code",[s._v("dynamic_partition.start")]),s._v("，分区范围在动态分区起始偏移之前的历史分区将会被删除。")]),s._v(" "),a("h4",{attrs:{id:"动态分区转换为手动分区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态分区转换为手动分区"}},[s._v("#")]),s._v(" 动态分区转换为手动分区")]),s._v(" "),a("p",[s._v("通过执行 "),a("code",[s._v('ALTER TABLE tbl_name SET ("dynamic_partition.enable" = "false")')]),s._v(" 即可关闭动态分区功能，将其转换为手动分区表。")]),s._v(" "),a("p",[s._v("关闭动态分区功能后，Doris 将不再自动管理分区，需要用户手动通过 "),a("code",[s._v("ALTER TABLE")]),s._v(" 的方式创建或删除分区。")])])]),s._v(" "),a("h2",{attrs:{id:"常见问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见问题"}},[s._v("#")]),s._v(" 常见问题")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("创建动态分区表后提示 "),a("code",[s._v("Could not create table with dynamic partition when fe config dynamic_partition_enable is false")])]),s._v(" "),a("p",[s._v("由于动态分区的总开关，也就是 FE 的配置 "),a("code",[s._v("dynamic_partition_enable")]),s._v(" 为 false，导致无法创建动态分区表。")]),s._v(" "),a("p",[s._v("这时候请修改 FE 的配置文件，增加一行 "),a("code",[s._v("dynamic_partition_enable=true")]),s._v('，并重启 FE。或者执行命令 ADMIN SET FRONTEND CONFIG ("dynamic_partition_enable" = "true") 将动态分区开关打开即可。')])])]),s._v(" "),a("h2",{attrs:{id:"更多帮助"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更多帮助"}},[s._v("#")]),s._v(" 更多帮助")]),s._v(" "),a("p",[s._v("关于动态分区使用的更多详细语法及最佳实践，请参阅 "),a("RouterLink",{attrs:{to:"/zh-CN/1.1/sql-manual/sql-reference/Show-Statements/SHOW-DYNAMIC-PARTITION.html"}},[s._v("SHOW DYNAMIC PARTITION")]),s._v(" 命令手册，你也可以在 MySql 客户端命令行下输入 "),a("code",[s._v("HELP ALTER TABLE")]),s._v(" 获取更多帮助信息。")],1)])}),[],!1,null,null,null);t.default=r.exports}}]);